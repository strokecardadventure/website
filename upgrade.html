<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="manifest" href="manifest.webmanifest"><meta name="theme-color" content="#e11d48">
<link rel="icon" href="assets/icons/pwa-192.png">
<link rel="stylesheet" href="css/global.css?v=10"><title>Upgrade</title></head>
<body>
<header class="header"><a class="icon-btn" href="my-cards.html">←</a><h1 class="title">Upgrade</h1><span class="icon-btn">⬆️</span></header>
<main id="app" class="content"></main>

<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
<script src="js/firebase.js"></script><script src="js/ui.js"></script><script src="js/cards.js"></script>
<script>
requireAuth().then(async ()=>{
  const u = await getUserDoc(); const have = new Set(u.unlocked||[]);
  const bases = [...new Set([...have].map(id=>baseOf(id)))];
  if (!bases.length){ app.innerHTML='<div class="tile">No cards yet.</div>'; return; }
  let out = `<div class="muted">3 exp style — +HP/DEF/ATK (cost = 3 + current level). Shards: ${u.mats?.shard||0}</div>`;
  for (const b of bases){
    const s = cardStatsWithUser(b,u); const lvl=(u.upgrades||{})[b]||0; const cost = 3+lvl;
    out += `<div class="tile" style="text-align:left">
      <div><strong>${findCard(b).name}</strong> · Lv.${lvl}</div>
      <div class="muted">HP ${s.hp} · ATK ${s.atk} · DEF ${s.def}</div>
      <button class="btn" onclick="upgradeCard('${b}').then(()=>location.reload())">Upgrade (-${cost} shard)</button>
    </div>`;
  }
  app.innerHTML = out;
});
</script>
</body></html>
